# –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –ø—Ä–∏–≤—è–∑–∫–∏ Telegram ‚Äî –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ø–æ—Å–æ–±–∞** –ø—Ä–∏–≤—è–∑–∫–∏ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞. –û–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

---

## üîµ –°–ø–æ—Å–æ–± 1: –ò–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### –ü—Ä–æ—Ü–µ—Å—Å:
1. –í–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí Telegram ‚Üí "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram"
2. –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É —Å —Ç–æ–∫–µ–Ω–æ–º
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ –±–æ—Ç–∞ –ø–æ —Å—Å—ã–ª–∫–µ
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:
- –í `telegram_link_tokens` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å:
  - `employee_id` = ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  - `token` = –¥–ª–∏–Ω–Ω—ã–π –±—É–∫–≤–µ–Ω–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç–æ–∫–µ–Ω
  - `tg_id` = NULL
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—è–≤–∏–ª—Å—è –ª–∏ `tg_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `employees`
- –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω, –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç Telegram ID

---

## üü¢ –°–ø–æ—Å–æ–± 2: –ò–∑ Telegram (–Ω–æ–≤—ã–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Å Telegram

### –ü—Ä–æ—Ü–µ—Å—Å:
1. –û—Ç–∫—Ä—ã—Ç—å Telegram ‚Üí @money_cheking_bot ‚Üí `/start`
2. –ü–æ–ª—É—á–∏—Ç—å 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
3. –í–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (email + –ø–∞—Ä–æ–ª—å)
4. –í–≤–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ Telegram
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:
- –í `telegram_link_tokens` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å:
  - `employee_id` = NULL
  - `token` = 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  - `tg_id` = Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `tg_id` —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
- –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å –ø–æ –∫–æ–¥—É, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç `tg_id` –∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É

---

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `telegram_link_tokens`:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | BIGSERIAL | ID –∑–∞–ø–∏—Å–∏ |
| `employee_id` | BIGINT | ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (NULL –¥–ª—è —Å–ø–æ—Å–æ–±–∞ 2) |
| `tg_id` | TEXT | Telegram ID (NULL –¥–ª—è —Å–ø–æ—Å–æ–±–∞ 1) |
| `token` | TEXT | –¢–æ–∫–µ–Ω/–∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `expires_at` | TIMESTAMP | –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (1 —á–∞—Å) |
| `used` | BOOLEAN | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ |

**–†–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —Å–ø–æ—Å–æ–±–∞–º–∏:**
- **–°–ø–æ—Å–æ–± 1 (—Å—Ç–∞—Ä—ã–π)**: `employee_id != NULL`, `tg_id = NULL`
- **–°–ø–æ—Å–æ–± 2 (–Ω–æ–≤—ã–π)**: `employee_id = NULL`, `tg_id != NULL`

---

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ Supabase SQL Editor:

```sql
-- –§–∞–π–ª: SQL_UPDATE_TELEGRAM_TOKENS.sql
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `SQL_UPDATE_TELEGRAM_TOKENS.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase.

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å Edge Function

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **Edge Functions** ‚Üí **telegram-webhook**
2. **Edit** —Ñ—É–Ω–∫—Ü–∏—é
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–¥ –∏–∑:
   ```
   supabase/functions/telegram-webhook/index.ts
   ```
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
5. **Deploy**

### –®–∞–≥ 3: –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Å–ø–æ—Å–æ–±–∞ 1 (–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É "üì± Telegram –ø–æ–¥–∫–ª—é—á—ë–Ω" (–∏–ª–∏ –∫—Ä–∞—Å–Ω—É—é "–ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram")
3. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±–æ—Ç–∞
6. –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏: "‚úÖ –ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!"
7. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è

### –¢–µ—Å—Ç —Å–ø–æ—Å–æ–±–∞ 2 (–∏–∑ Telegram):

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí @money_cheking_bot
2. –ù–∞–ø–∏—à–∏—Ç–µ `/start`
3. –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ (6 —Ü–∏—Ñ—Ä)
4. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
5. –í–æ–π–¥–∏—Ç–µ —Å email/–ø–∞—Ä–æ–ª–µ–º
6. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —ç–∫—Ä–∞–Ω "–ü—Ä–∏–≤—è–∑–∫–∞ Telegram"
7. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥
8. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram"
9. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!"

---

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞:

- **Edge Function** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞:
  - `/start TOKEN` (–¥–ª–∏–Ω–Ω—ã–π) ‚Üí –°–ø–æ—Å–æ–± 1
  - `/start` (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞) ‚Üí –°–ø–æ—Å–æ–± 2

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
  - –ï—Å—Ç—å –ª–∏ `tg_id` —É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –∫–æ–¥–∞

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:

- **–°–ø–æ—Å–æ–± 1:** –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑
- **–°–ø–æ—Å–æ–± 2:** –ö–∞–∂–¥—ã–π `/start` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –∫–æ–¥ (—Å—Ç–∞—Ä—ã–π –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞)

### –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:

- **–û–±–∞ —Å–ø–æ—Å–æ–±–∞:** 1 —á–∞—Å —Å –º–æ–º–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è:

- **–°–ø–æ—Å–æ–± 1:** –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π –¥–ª–∏–Ω—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ)
- **–°–ø–æ—Å–æ–± 2:** –ö–æ–¥ —Å—Ç—Ä–æ–≥–æ 6 —Ü–∏—Ñ—Ä

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–≤–æ–π–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

| –ê—Å–ø–µ–∫—Ç | –°–ø–æ—Å–æ–± 1 (—Å—Ç–∞—Ä—ã–π) | –°–ø–æ—Å–æ–± 2 (–Ω–æ–≤—ã–π) |
|--------|-------------------|------------------|
| –£–¥–æ–±—Å—Ç–≤–æ | –¢—Ä–µ–±—É–µ—Ç —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π—Ç–∏ | –ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å Telegram |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –¢–æ–∫–µ–Ω –¥–ª–∏–Ω–Ω—ã–π, —Å–ª–æ–∂–Ω—ã–π | –ö–æ–¥ –∫–æ—Ä–æ—Ç–∫–∏–π, –Ω–æ —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL |
| UX | 4 —à–∞–≥–∞ | 4 —à–∞–≥–∞ |
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫ | –í–≤–æ–¥ –≤—Ä—É—á–Ω—É—é |
| –°–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –ï—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é | –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–∞—á–∏–Ω–∞–µ—Ç —Å Telegram |

---

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –í Supabase Logs:

- –ò—â–∏—Ç–µ `telegram-webhook` ‚Üí **Logs**
- –ü—Ä–∏ —Å–ø–æ—Å–æ–±–µ 1: `"Token found, employee_id: 2"`
- –ü—Ä–∏ —Å–ø–æ—Å–æ–±–µ 2: `"Generated code: 123456 for tg_id: 789"`

### –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞):

- –ü—Ä–∏ —Å–ø–æ—Å–æ–±–µ 1: `"Checking tg_id for employee: 2"` ‚Üí `"Telegram linked! tg_id: 789"`
- –ü—Ä–∏ —Å–ø–æ—Å–æ–±–µ 2: –ù–µ—Ç –ª–æ–≥–æ–≤ (–∫–æ–¥ –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é)

---

## ‚ùì FAQ

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

–ù–µ—Ç, –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑. –ï—Å–ª–∏ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω —á–µ—Ä–µ–∑ —Å–ø–æ—Å–æ–± 1, —Å–ø–æ—Å–æ–± 2 –ø–æ–∫–∞–∂–µ—Ç "–ê–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω".

### –ß—Ç–æ –µ—Å–ª–∏ –∫–æ–¥/—Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫?

- **–°–ø–æ—Å–æ–± 1:** –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–°–ø–æ—Å–æ–± 2:** –ù–∞–ø–∏—à–∏—Ç–µ `/start` –≤ –±–æ—Ç–µ —Å–Ω–æ–≤–∞

### –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤?

–î–∞:
- **–û—Ç–∫–ª—é—á–∏—Ç—å —Å–ø–æ—Å–æ–± 1:** –£–¥–∞–ª–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram" –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–û—Ç–∫–ª—é—á–∏—Ç—å —Å–ø–æ—Å–æ–± 2:** –ò–∑–º–µ–Ω–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É `/start` –≤ Edge Function

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å Telegram –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏ –Ω–∞ –≤—ã–±–æ—Ä!
